use mini_neural_network::{
    Matrix, Number,
    layers::{
        activation_layer::ActivationLayer, identity_layer::IdentityLayer, layer::Layer,
        mse_loss_layer::MSELossLayer, relu_layer::ReluLayer,
    },
    multilayer_network::MultiLayerNetwork,
    preprocessor::Preprocessor,
    trainer::Trainer,
    utils::argmax_in_matrix,
};
use ndarray::{Axis, arr2};
use ndarray_rand::{RandomExt, SamplingStrategy};
use ndarray_stats::QuantileExt;

const VERBOSE: bool = true;

const LEARNING_RATE: Number = 0.01;

const N_FEATURES: usize = 7;
#[allow(clippy::excessive_precision)]
const DATASET: &[[Number; N_FEATURES]] = &[
    [
        5.099999999999999645e+00,
        3.500000000000000000e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.900000000000000355e+00,
        3.000000000000000000e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.700000000000000178e+00,
        3.200000000000000178e+00,
        1.300000000000000044e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.599999999999999645e+00,
        3.100000000000000089e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.600000000000000089e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.400000000000000355e+00,
        3.899999999999999911e+00,
        1.699999999999999956e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.599999999999999645e+00,
        3.399999999999999911e+00,
        1.399999999999999911e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.399999999999999911e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.400000000000000355e+00,
        2.899999999999999911e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.900000000000000355e+00,
        3.100000000000000089e+00,
        1.500000000000000000e+00,
        1.000000000000000056e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.400000000000000355e+00,
        3.700000000000000178e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.799999999999999822e+00,
        3.399999999999999911e+00,
        1.600000000000000089e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.799999999999999822e+00,
        3.000000000000000000e+00,
        1.399999999999999911e+00,
        1.000000000000000056e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.299999999999999822e+00,
        3.000000000000000000e+00,
        1.100000000000000089e+00,
        1.000000000000000056e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        4.000000000000000000e+00,
        1.199999999999999956e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        4.400000000000000355e+00,
        1.500000000000000000e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.400000000000000355e+00,
        3.899999999999999911e+00,
        1.300000000000000044e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.500000000000000000e+00,
        1.399999999999999911e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        3.799999999999999822e+00,
        1.699999999999999956e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.799999999999999822e+00,
        1.500000000000000000e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.400000000000000355e+00,
        3.399999999999999911e+00,
        1.699999999999999956e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.700000000000000178e+00,
        1.500000000000000000e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.599999999999999645e+00,
        3.600000000000000089e+00,
        1.000000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.299999999999999822e+00,
        1.699999999999999956e+00,
        5.000000000000000000e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.799999999999999822e+00,
        3.399999999999999911e+00,
        1.899999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.000000000000000000e+00,
        1.600000000000000089e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.399999999999999911e+00,
        1.600000000000000089e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.200000000000000178e+00,
        3.500000000000000000e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.200000000000000178e+00,
        3.399999999999999911e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.700000000000000178e+00,
        3.200000000000000178e+00,
        1.600000000000000089e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.799999999999999822e+00,
        3.100000000000000089e+00,
        1.600000000000000089e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.400000000000000355e+00,
        3.399999999999999911e+00,
        1.500000000000000000e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.200000000000000178e+00,
        4.099999999999999645e+00,
        1.500000000000000000e+00,
        1.000000000000000056e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        4.200000000000000178e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.900000000000000355e+00,
        3.100000000000000089e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.200000000000000178e+00,
        1.199999999999999956e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        3.500000000000000000e+00,
        1.300000000000000044e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.900000000000000355e+00,
        3.600000000000000089e+00,
        1.399999999999999911e+00,
        1.000000000000000056e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.400000000000000355e+00,
        3.000000000000000000e+00,
        1.300000000000000044e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.399999999999999911e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.500000000000000000e+00,
        1.300000000000000044e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.500000000000000000e+00,
        2.299999999999999822e+00,
        1.300000000000000044e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.400000000000000355e+00,
        3.200000000000000178e+00,
        1.300000000000000044e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.500000000000000000e+00,
        1.600000000000000089e+00,
        5.999999999999999778e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.799999999999999822e+00,
        1.899999999999999911e+00,
        4.000000000000000222e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.799999999999999822e+00,
        3.000000000000000000e+00,
        1.399999999999999911e+00,
        2.999999999999999889e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        3.799999999999999822e+00,
        1.600000000000000089e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.599999999999999645e+00,
        3.200000000000000178e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.299999999999999822e+00,
        3.700000000000000178e+00,
        1.500000000000000000e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        3.299999999999999822e+00,
        1.399999999999999911e+00,
        2.000000000000000111e-01,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        7.000000000000000000e+00,
        3.200000000000000178e+00,
        4.700000000000000178e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        3.200000000000000178e+00,
        4.500000000000000000e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.900000000000000355e+00,
        3.100000000000000089e+00,
        4.900000000000000355e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        2.299999999999999822e+00,
        4.000000000000000000e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.500000000000000000e+00,
        2.799999999999999822e+00,
        4.599999999999999645e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        2.799999999999999822e+00,
        4.500000000000000000e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        3.299999999999999822e+00,
        4.700000000000000178e+00,
        1.600000000000000089e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        4.900000000000000355e+00,
        2.399999999999999911e+00,
        3.299999999999999822e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.599999999999999645e+00,
        2.899999999999999911e+00,
        4.599999999999999645e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.200000000000000178e+00,
        2.700000000000000178e+00,
        3.899999999999999911e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        2.000000000000000000e+00,
        3.500000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.900000000000000355e+00,
        3.000000000000000000e+00,
        4.200000000000000178e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.000000000000000000e+00,
        2.200000000000000178e+00,
        4.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.099999999999999645e+00,
        2.899999999999999911e+00,
        4.700000000000000178e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.599999999999999645e+00,
        2.899999999999999911e+00,
        3.600000000000000089e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.100000000000000089e+00,
        4.400000000000000355e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.599999999999999645e+00,
        3.000000000000000000e+00,
        4.500000000000000000e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        2.700000000000000178e+00,
        4.099999999999999645e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.200000000000000178e+00,
        2.200000000000000178e+00,
        4.500000000000000000e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.599999999999999645e+00,
        2.500000000000000000e+00,
        3.899999999999999911e+00,
        1.100000000000000089e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.900000000000000355e+00,
        3.200000000000000178e+00,
        4.799999999999999822e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.099999999999999645e+00,
        2.799999999999999822e+00,
        4.000000000000000000e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        2.500000000000000000e+00,
        4.900000000000000355e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.099999999999999645e+00,
        2.799999999999999822e+00,
        4.700000000000000178e+00,
        1.199999999999999956e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        2.899999999999999911e+00,
        4.299999999999999822e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.599999999999999645e+00,
        3.000000000000000000e+00,
        4.400000000000000355e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.799999999999999822e+00,
        2.799999999999999822e+00,
        4.799999999999999822e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.000000000000000000e+00,
        5.000000000000000000e+00,
        1.699999999999999956e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.000000000000000000e+00,
        2.899999999999999911e+00,
        4.500000000000000000e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        2.600000000000000089e+00,
        3.500000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        2.399999999999999911e+00,
        3.799999999999999822e+00,
        1.100000000000000089e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        2.399999999999999911e+00,
        3.700000000000000178e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        2.700000000000000178e+00,
        3.899999999999999911e+00,
        1.199999999999999956e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.000000000000000000e+00,
        2.700000000000000178e+00,
        5.099999999999999645e+00,
        1.600000000000000089e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.400000000000000355e+00,
        3.000000000000000000e+00,
        4.500000000000000000e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.000000000000000000e+00,
        3.399999999999999911e+00,
        4.500000000000000000e+00,
        1.600000000000000089e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.100000000000000089e+00,
        4.700000000000000178e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        2.299999999999999822e+00,
        4.400000000000000355e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.599999999999999645e+00,
        3.000000000000000000e+00,
        4.099999999999999645e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        2.500000000000000000e+00,
        4.000000000000000000e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.500000000000000000e+00,
        2.600000000000000089e+00,
        4.400000000000000355e+00,
        1.199999999999999956e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.099999999999999645e+00,
        3.000000000000000000e+00,
        4.599999999999999645e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        2.600000000000000089e+00,
        4.000000000000000000e+00,
        1.199999999999999956e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.000000000000000000e+00,
        2.299999999999999822e+00,
        3.299999999999999822e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.599999999999999645e+00,
        2.700000000000000178e+00,
        4.200000000000000178e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        3.000000000000000000e+00,
        4.200000000000000178e+00,
        1.199999999999999956e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        2.899999999999999911e+00,
        4.200000000000000178e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.200000000000000178e+00,
        2.899999999999999911e+00,
        4.299999999999999822e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.099999999999999645e+00,
        2.500000000000000000e+00,
        3.000000000000000000e+00,
        1.100000000000000089e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        2.799999999999999822e+00,
        4.099999999999999645e+00,
        1.300000000000000044e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
        0.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        3.299999999999999822e+00,
        6.000000000000000000e+00,
        2.500000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        2.700000000000000178e+00,
        5.099999999999999645e+00,
        1.899999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.099999999999999645e+00,
        3.000000000000000000e+00,
        5.900000000000000355e+00,
        2.100000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        2.899999999999999911e+00,
        5.599999999999999645e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.500000000000000000e+00,
        3.000000000000000000e+00,
        5.799999999999999822e+00,
        2.200000000000000178e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.599999999999999645e+00,
        3.000000000000000000e+00,
        6.599999999999999645e+00,
        2.100000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        4.900000000000000355e+00,
        2.500000000000000000e+00,
        4.500000000000000000e+00,
        1.699999999999999956e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.299999999999999822e+00,
        2.899999999999999911e+00,
        6.299999999999999822e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        2.500000000000000000e+00,
        5.799999999999999822e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.200000000000000178e+00,
        3.600000000000000089e+00,
        6.099999999999999645e+00,
        2.500000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.500000000000000000e+00,
        3.200000000000000178e+00,
        5.099999999999999645e+00,
        2.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        2.700000000000000178e+00,
        5.299999999999999822e+00,
        1.899999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.799999999999999822e+00,
        3.000000000000000000e+00,
        5.500000000000000000e+00,
        2.100000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        5.700000000000000178e+00,
        2.500000000000000000e+00,
        5.000000000000000000e+00,
        2.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        2.799999999999999822e+00,
        5.099999999999999645e+00,
        2.399999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        3.200000000000000178e+00,
        5.299999999999999822e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.500000000000000000e+00,
        3.000000000000000000e+00,
        5.500000000000000000e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.700000000000000178e+00,
        3.799999999999999822e+00,
        6.700000000000000178e+00,
        2.200000000000000178e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.700000000000000178e+00,
        2.600000000000000089e+00,
        6.900000000000000355e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.000000000000000000e+00,
        2.200000000000000178e+00,
        5.000000000000000000e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.900000000000000355e+00,
        3.200000000000000178e+00,
        5.700000000000000178e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        5.599999999999999645e+00,
        2.799999999999999822e+00,
        4.900000000000000355e+00,
        2.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.700000000000000178e+00,
        2.799999999999999822e+00,
        6.700000000000000178e+00,
        2.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        2.700000000000000178e+00,
        4.900000000000000355e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.299999999999999822e+00,
        5.700000000000000178e+00,
        2.100000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.200000000000000178e+00,
        3.200000000000000178e+00,
        6.000000000000000000e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.200000000000000178e+00,
        2.799999999999999822e+00,
        4.799999999999999822e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.099999999999999645e+00,
        3.000000000000000000e+00,
        4.900000000000000355e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        2.799999999999999822e+00,
        5.599999999999999645e+00,
        2.100000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.200000000000000178e+00,
        3.000000000000000000e+00,
        5.799999999999999822e+00,
        1.600000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.400000000000000355e+00,
        2.799999999999999822e+00,
        6.099999999999999645e+00,
        1.899999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.900000000000000355e+00,
        3.799999999999999822e+00,
        6.400000000000000355e+00,
        2.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        2.799999999999999822e+00,
        5.599999999999999645e+00,
        2.200000000000000178e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        2.799999999999999822e+00,
        5.099999999999999645e+00,
        1.500000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.099999999999999645e+00,
        2.600000000000000089e+00,
        5.599999999999999645e+00,
        1.399999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        7.700000000000000178e+00,
        3.000000000000000000e+00,
        6.099999999999999645e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        3.399999999999999911e+00,
        5.599999999999999645e+00,
        2.399999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.400000000000000355e+00,
        3.100000000000000089e+00,
        5.500000000000000000e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.000000000000000000e+00,
        3.000000000000000000e+00,
        4.799999999999999822e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.900000000000000355e+00,
        3.100000000000000089e+00,
        5.400000000000000355e+00,
        2.100000000000000089e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.100000000000000089e+00,
        5.599999999999999645e+00,
        2.399999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.900000000000000355e+00,
        3.100000000000000089e+00,
        5.099999999999999645e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        5.799999999999999822e+00,
        2.700000000000000178e+00,
        5.099999999999999645e+00,
        1.899999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.799999999999999822e+00,
        3.200000000000000178e+00,
        5.900000000000000355e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.299999999999999822e+00,
        5.700000000000000178e+00,
        2.500000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.700000000000000178e+00,
        3.000000000000000000e+00,
        5.200000000000000178e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.299999999999999822e+00,
        2.500000000000000000e+00,
        5.000000000000000000e+00,
        1.899999999999999911e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.500000000000000000e+00,
        3.000000000000000000e+00,
        5.200000000000000178e+00,
        2.000000000000000000e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        6.200000000000000178e+00,
        3.399999999999999911e+00,
        5.400000000000000355e+00,
        2.299999999999999822e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
    [
        5.900000000000000355e+00,
        3.000000000000000000e+00,
        5.099999999999999645e+00,
        1.800000000000000044e+00,
        0.000000000000000000e+00,
        0.000000000000000000e+00,
        1.000000000000000000e+00,
    ],
];

fn main() {
    let input_dim = 4;
    let neurons = [16, 3];
    let activations = vec![
        ActivationLayer::ReLU(ReluLayer::default()),
        ActivationLayer::Identity(IdentityLayer),
    ];

    let mut network = MultiLayerNetwork::new(input_dim, &neurons, activations);

    let dataset: Matrix = arr2(DATASET);
    let n = dataset.nrows();
    let train_size = n * 4 / 5; // 0.8n

    let dataset = dataset.sample_axis(Axis(0), n, SamplingStrategy::WithoutReplacement);

    let (train, test) = dataset.view().split_at(Axis(0), train_size);

    let (x_train, y_train) = train.split_at(Axis(1), 4);
    let (x_test, y_test) = test.split_at(Axis(1), 4);

    let prep = Preprocessor::new(x_train.to_owned());

    let x_train_preped = prep.apply(x_train.to_owned());
    let x_test_preped = prep.apply(x_test.to_owned());

    let mut trainer = Trainer::new(
        &mut network,
        Box::new(MSELossLayer::default()),
        8,
        1000,
        LEARNING_RATE,
        true,
    );

    trainer.train(x_train_preped.clone(), y_train.to_owned(), VERBOSE);
    println!(
        "Train loss: {}",
        trainer.eval_loss(x_train_preped, y_train.to_owned())
    );
    println!(
        "Validation loss: {}",
        trainer.eval_loss(x_test_preped.clone(), y_test.to_owned())
    );

    let preds = argmax_in_matrix(&network.forward(x_test_preped))
        .into_dyn()
        .squeeze();
    let targets = argmax_in_matrix(&y_test.to_owned()).into_dyn().squeeze();

    let total = preds.len();
    let accuracy = (0..total)
        .map(|i| {
            if preds[i] == targets[i] {
                1.0 as Number
            } else {
                0.0 as Number
            }
        })
        .sum::<Number>()
        / total as Number;

    println!("Predictions: {preds}");
    println!("Targets: {targets}");
    println!("Accuracy: {accuracy}");
}
